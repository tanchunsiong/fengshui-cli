<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÂÖ´Â≠óÂëΩÁõò | BaZi Calculator - Four Pillars of Destiny</title>
  <meta name="description" content="Calculate your Four Pillars of Destiny (BaZi/ÂÖ´Â≠ó) based on your birth date and time. Free Chinese astrology reading.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0a0a0f;
      --bg-card: #12121a;
      --gold: #d4a853;
      --gold-light: #f0d48a;
      --red: #c73030;
      --green: #2d7d46;
      --blue: #3d6ea8;
      --white: #e8e8e8;
      --gray: #888;
      --wood: #4caf50;
      --fire: #f44336;
      --earth: #ffc107;
      --metal: #9e9e9e;
      --water: #2196f3;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-dark);
      color: var(--white);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      padding: 40px 20px;
      border-bottom: 1px solid rgba(212, 168, 83, 0.3);
      margin-bottom: 40px;
    }
    
    h1 {
      font-family: 'Noto Serif SC', serif;
      font-size: 2.5em;
      color: var(--gold);
      margin-bottom: 10px;
    }
    
    .subtitle {
      color: var(--gray);
      font-size: 1.1em;
    }
    
    .input-section {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      border: 1px solid rgba(212, 168, 83, 0.2);
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
    }
    
    label {
      font-size: 0.85em;
      color: var(--gold);
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    input, select {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 12px 15px;
      color: var(--white);
      font-size: 1em;
      font-family: inherit;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: var(--gold);
    }
    
    button {
      background: linear-gradient(135deg, var(--gold), #c49a3d);
      color: #000;
      border: none;
      border-radius: 8px;
      padding: 15px 40px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      display: block;
      margin: 0 auto;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(212, 168, 83, 0.4);
    }
    
    .note {
      font-size: 0.85em;
      color: var(--gray);
      text-align: center;
      margin-top: 15px;
    }
    
    #result {
      display: none;
    }
    
    .result-card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 30px;
      border: 1px solid rgba(212, 168, 83, 0.2);
      margin-bottom: 25px;
    }
    
    .result-card h2 {
      font-family: 'Noto Serif SC', serif;
      color: var(--gold);
      margin-bottom: 20px;
      font-size: 1.4em;
    }
    
    .pillars-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 25px;
    }
    
    .pillar {
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
    }
    
    .pillar-label {
      font-size: 0.8em;
      color: var(--gray);
      margin-bottom: 10px;
    }
    
    .pillar-chinese {
      font-size: 0.75em;
      color: var(--gray);
    }
    
    .stem, .branch {
      font-family: 'Noto Serif SC', serif;
      font-size: 2em;
      margin: 10px 0;
    }
    
    .element-tag {
      font-size: 0.75em;
      padding: 3px 8px;
      border-radius: 4px;
      display: inline-block;
      margin-top: 5px;
    }
    
    .element-Wood { background: rgba(76, 175, 80, 0.3); color: var(--wood); }
    .element-Fire { background: rgba(244, 67, 54, 0.3); color: var(--fire); }
    .element-Earth { background: rgba(255, 193, 7, 0.3); color: var(--earth); }
    .element-Metal { background: rgba(158, 158, 158, 0.3); color: var(--metal); }
    .element-Water { background: rgba(33, 150, 243, 0.3); color: var(--water); }
    
    .animal-icon {
      font-size: 0.85em;
      margin-top: 8px;
      color: var(--gray);
    }
    
    .day-master {
      text-align: center;
      padding: 25px;
      background: linear-gradient(135deg, rgba(212, 168, 83, 0.1), rgba(212, 168, 83, 0.05));
      border-radius: 12px;
      margin-bottom: 25px;
    }
    
    .day-master h3 {
      font-family: 'Noto Serif SC', serif;
      color: var(--gold-light);
      font-size: 1.5em;
      margin-bottom: 10px;
    }
    
    .day-master .nature {
      font-style: italic;
      color: var(--gray);
      margin-bottom: 15px;
    }
    
    .day-master .description {
      line-height: 1.6;
      margin-bottom: 15px;
    }
    
    .traits {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .trait {
      background: rgba(255,255,255,0.1);
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
    }
    
    .elements-chart {
      display: grid;
      gap: 12px;
    }
    
    .element-row {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .element-name {
      width: 60px;
      font-weight: 500;
    }
    
    .element-bar {
      flex: 1;
      height: 24px;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      overflow: hidden;
    }
    
    .element-fill {
      height: 100%;
      border-radius: 12px;
      transition: width 0.5s ease;
    }
    
    .element-count {
      width: 30px;
      text-align: center;
    }
    
    .lucky-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 25px;
    }
    
    .lucky-box {
      padding: 15px;
      border-radius: 10px;
    }
    
    .lucky-box.good {
      background: rgba(45, 125, 70, 0.2);
      border: 1px solid rgba(45, 125, 70, 0.4);
    }
    
    .lucky-box.bad {
      background: rgba(199, 48, 48, 0.2);
      border: 1px solid rgba(199, 48, 48, 0.4);
    }
    
    .lucky-box h4 {
      margin-bottom: 10px;
      font-size: 0.9em;
    }
    
    .lucky-box.good h4 { color: var(--green); }
    .lucky-box.bad h4 { color: var(--red); }
    
    .life-cycles {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 10px;
    }
    
    .cycle {
      background: rgba(255,255,255,0.05);
      padding: 12px;
      border-radius: 8px;
      text-align: center;
    }
    
    .cycle-age {
      font-size: 0.8em;
      color: var(--gray);
      margin-bottom: 5px;
    }
    
    .cycle-ganzhi {
      font-family: 'Noto Serif SC', serif;
      font-size: 1.3em;
    }
    
    footer {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray);
      border-top: 1px solid rgba(212, 168, 83, 0.2);
      margin-top: 40px;
    }
    
    footer a {
      color: var(--gold);
      text-decoration: none;
    }
    
    @media (max-width: 600px) {
      .pillars-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      .stem, .branch {
        font-size: 1.5em;
      }
      .lucky-section {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ÂÖ´Â≠óÂëΩÁõò</h1>
      <p class="subtitle">Four Pillars of Destiny Calculator</p>
    </header>
    
    <div class="input-section">
      <div class="form-grid">
        <div class="form-group">
          <label>Birth Year Âá∫ÁîüÂπ¥</label>
          <input type="number" id="year" min="1900" max="2100" placeholder="1990">
        </div>
        <div class="form-group">
          <label>Month Êúà</label>
          <select id="month">
            <option value="1">January</option>
            <option value="2">February</option>
            <option value="3">March</option>
            <option value="4">April</option>
            <option value="5">May</option>
            <option value="6">June</option>
            <option value="7">July</option>
            <option value="8">August</option>
            <option value="9">September</option>
            <option value="10">October</option>
            <option value="11">November</option>
            <option value="12">December</option>
          </select>
        </div>
        <div class="form-group">
          <label>Day Êó•</label>
          <input type="number" id="day" min="1" max="31" placeholder="15">
        </div>
        <div class="form-group">
          <label>Hour Êó∂</label>
          <select id="hour">
            <option value="0">00:00 - Â≠êÊó∂ (Rat)</option>
            <option value="1">01:00 - ‰∏ëÊó∂ (Ox)</option>
            <option value="3">03:00 - ÂØÖÊó∂ (Tiger)</option>
            <option value="5">05:00 - ÂçØÊó∂ (Rabbit)</option>
            <option value="7">07:00 - Ëæ∞Êó∂ (Dragon)</option>
            <option value="9">09:00 - Â∑≥Êó∂ (Snake)</option>
            <option value="11">11:00 - ÂçàÊó∂ (Horse)</option>
            <option value="13">13:00 - Êú™Êó∂ (Goat)</option>
            <option value="15">15:00 - Áî≥Êó∂ (Monkey)</option>
            <option value="17">17:00 - ÈÖâÊó∂ (Rooster)</option>
            <option value="19">19:00 - ÊàåÊó∂ (Dog)</option>
            <option value="21">21:00 - ‰∫•Êó∂ (Pig)</option>
            <option value="12" selected>Unknown (Noon)</option>
          </select>
        </div>
      </div>
      <button onclick="calculateBaZi()">Calculate ËÆ°ÁÆó</button>
      <p class="note">‚è∞ Birth time significantly affects your Hour Pillar. Select "Unknown" if unsure.</p>
    </div>
    
    <div id="result">
      <div class="result-card">
        <h2>ÂõõÊü± Four Pillars</h2>
        <div id="birth-info" style="text-align: center; margin-bottom: 20px; color: var(--gray);"></div>
        <div class="pillars-grid" id="pillars"></div>
      </div>
      
      <div class="result-card">
        <h2>Êó•‰∏ª Day Master</h2>
        <div class="day-master" id="day-master"></div>
      </div>
      
      <div class="result-card">
        <h2>‰∫îË°åÂàÜÂ∏É Five Elements</h2>
        <div class="elements-chart" id="elements"></div>
        <div class="lucky-section" id="lucky"></div>
      </div>
      
      <div class="result-card" id="cycles-card">
        <h2>Â§ßËøê Major Life Cycles</h2>
        <div class="life-cycles" id="cycles"></div>
      </div>
    </div>
    
    <footer>
      <p>Built with üí† by <a href="https://github.com/tanchunsiong/fengshui-cli">fengshui-cli</a></p>
      <p style="margin-top: 10px;"><a href="index.html">‚Üê Daily Almanac</a></p>
    </footer>
  </div>
  
  <script>
    // Element colors
    const elementColors = {
      Wood: '#4caf50',
      Fire: '#f44336',
      Earth: '#ffc107',
      Metal: '#9e9e9e',
      Water: '#2196f3'
    };
    
    async function calculateBaZi() {
      const year = document.getElementById('year').value;
      const month = document.getElementById('month').value;
      const day = document.getElementById('day').value;
      const hour = document.getElementById('hour').value;
      
      if (!year || !month || !day) {
        alert('Please enter your birth date');
        return;
      }
      
      const dateStr = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
      
      try {
        // Use local calculation (embedded data) or API
        const url = `https://fengshui-api.openclaw.ai/bazi/${dateStr}/${hour}:00`;
        // Fallback: use a simple client-side calculation stub
        // For now, we'll show a demo result
        
        // Try API first
        let data;
        try {
          const response = await fetch(url);
          if (response.ok) {
            data = await response.json();
          } else {
            throw new Error('API unavailable');
          }
        } catch (e) {
          // Use demo calculation
          data = calculateLocal(parseInt(year), parseInt(month), parseInt(day), parseInt(hour));
        }
        
        renderResult(data);
        document.getElementById('result').style.display = 'block';
        document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
        
      } catch (e) {
        alert('Error calculating BaZi: ' + e.message);
      }
    }
    
    // Simplified local calculation for demo
    function calculateLocal(year, month, day, hour) {
      // This is a simplified placeholder - the actual calculation
      // should use the lunar-typescript library server-side
      const stems = ['Áî≤','‰πô','‰∏ô','‰∏Å','Êàä','Â∑±','Â∫ö','Ëæõ','Â£¨','Áô∏'];
      const branches = ['Â≠ê','‰∏ë','ÂØÖ','ÂçØ','Ëæ∞','Â∑≥','Âçà','Êú™','Áî≥','ÈÖâ','Êàå','‰∫•'];
      const animals = ['Rat','Ox','Tiger','Rabbit','Dragon','Snake','Horse','Goat','Monkey','Rooster','Dog','Pig'];
      const elements = ['Wood','Wood','Fire','Fire','Earth','Earth','Metal','Metal','Water','Water'];
      const branchElements = ['Water','Earth','Wood','Wood','Earth','Fire','Fire','Earth','Metal','Metal','Earth','Water'];
      
      // Simplified year calculation
      const yearStemIdx = (year - 4) % 10;
      const yearBranchIdx = (year - 4) % 12;
      
      // Very rough approximations for demo
      const dayStemIdx = (year * 5 + Math.floor((month + 1) / 2) + day) % 10;
      const dayBranchIdx = (year + month + day) % 12;
      const monthStemIdx = ((yearStemIdx % 5) * 2 + month) % 10;
      const monthBranchIdx = (month + 1) % 12;
      const hourIdx = Math.floor(((hour + 1) % 24) / 2);
      const hourStemIdx = (dayStemIdx * 2 + hourIdx) % 10;
      
      return {
        solarDate: `${year}-${String(month).padStart(2,'0')}-${String(day).padStart(2,'0')}`,
        lunarDate: 'Lunar date',
        zodiac: animals[yearBranchIdx],
        fourPillars: {
          year: {
            chinese: stems[yearStemIdx] + branches[yearBranchIdx],
            stem: { chinese: stems[yearStemIdx], element: elements[yearStemIdx], english: (yearStemIdx % 2 === 0 ? 'Yang ' : 'Yin ') + elements[yearStemIdx] },
            branch: { chinese: branches[yearBranchIdx], animal: animals[yearBranchIdx], element: branchElements[yearBranchIdx] }
          },
          month: {
            chinese: stems[monthStemIdx] + branches[monthBranchIdx],
            stem: { chinese: stems[monthStemIdx], element: elements[monthStemIdx], english: (monthStemIdx % 2 === 0 ? 'Yang ' : 'Yin ') + elements[monthStemIdx] },
            branch: { chinese: branches[monthBranchIdx], animal: animals[monthBranchIdx], element: branchElements[monthBranchIdx] }
          },
          day: {
            chinese: stems[dayStemIdx] + branches[dayBranchIdx],
            stem: { chinese: stems[dayStemIdx], element: elements[dayStemIdx], english: (dayStemIdx % 2 === 0 ? 'Yang ' : 'Yin ') + elements[dayStemIdx] },
            branch: { chinese: branches[dayBranchIdx], animal: animals[dayBranchIdx], element: branchElements[dayBranchIdx] }
          },
          hour: {
            chinese: stems[hourStemIdx] + branches[hourIdx],
            stem: { chinese: stems[hourStemIdx], element: elements[hourStemIdx], english: (hourStemIdx % 2 === 0 ? 'Yang ' : 'Yin ') + elements[hourStemIdx] },
            branch: { chinese: branches[hourIdx], animal: animals[hourIdx], element: branchElements[hourIdx] }
          }
        },
        dayMaster: {
          chinese: stems[dayStemIdx],
          element: elements[dayStemIdx],
          english: (dayStemIdx % 2 === 0 ? 'Yang ' : 'Yin ') + elements[dayStemIdx],
          nature: ['The Towering Tree','The Flexible Vine','The Blazing Sun','The Candlelight','The Mountain','The Garden Soil','The Sword','The Jewel','The Ocean','The Rain'][dayStemIdx],
          traits: [['Leader','Ambitious'],['Adaptable','Diplomatic'],['Charismatic','Generous'],['Thoughtful','Creative'],['Reliable','Patient'],['Nurturing','Humble'],['Decisive','Direct'],['Refined','Perfectionist'],['Wise','Adventurous'],['Intuitive','Nurturing']][dayStemIdx],
          description: [
            'Strong, principled, and growth-oriented. Natural leaders.',
            'Graceful and resilient. Bends but doesn\'t break.',
            'Radiates warmth and energy. Natural entertainers.',
            'Illuminates details others miss. Artistic souls.',
            'Solid and dependable. Creates stability.',
            'Supports growth in others. Practical minds.',
            'Sharp and commanding. Warriors with decisive action.',
            'Values beauty and quality. Discerning minds.',
            'Deep and far-reaching. Intellectual explorers.',
            'Brings life and nourishment. Deeply empathetic.'
          ][dayStemIdx]
        },
        elements: {
          Wood: 0, Fire: 0, Earth: 0, Metal: 0, Water: 0
        },
        luckyElements: ['Water', 'Metal'],
        unluckyElements: ['Fire'],
        lifeCycles: []
      };
    }
    
    function renderResult(data) {
      // Birth info
      document.getElementById('birth-info').innerHTML = `
        üìÖ ${data.solarDate} &nbsp;|&nbsp; üê≤ ${data.zodiac}
      `;
      
      // Four Pillars
      const pillarsHtml = ['hour', 'day', 'month', 'year'].map(key => {
        const p = data.fourPillars[key];
        const labels = { hour: 'HOUR ÊôÇÊü±', day: 'DAY Êó•Êü±', month: 'MONTH ÊúàÊü±', year: 'YEAR Âπ¥Êü±' };
        return `
          <div class="pillar">
            <div class="pillar-label">${labels[key]}</div>
            <div class="stem" style="color: ${elementColors[p.stem.element]}">${p.stem.chinese}</div>
            <span class="element-tag element-${p.stem.element}">${p.stem.element}</span>
            <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 10px 0;"></div>
            <div class="branch" style="color: ${elementColors[p.branch.element]}">${p.branch.chinese}</div>
            <div class="animal-icon">${p.branch.animal}</div>
          </div>
        `;
      }).join('');
      document.getElementById('pillars').innerHTML = pillarsHtml;
      
      // Day Master
      const dm = data.dayMaster;
      document.getElementById('day-master').innerHTML = `
        <h3>${dm.chinese} ${dm.english}</h3>
        <div class="nature">"${dm.nature}"</div>
        <div class="description">${dm.description}</div>
        <div class="traits">
          ${dm.traits.map(t => `<span class="trait">${t}</span>`).join('')}
        </div>
      `;
      
      // Elements chart
      const maxEl = Math.max(...Object.values(data.elements), 1);
      const elementsHtml = Object.entries(data.elements).map(([el, count]) => `
        <div class="element-row">
          <span class="element-name" style="color: ${elementColors[el]}">${el}</span>
          <div class="element-bar">
            <div class="element-fill" style="width: ${(count/maxEl)*100}%; background: ${elementColors[el]};"></div>
          </div>
          <span class="element-count">${count}</span>
        </div>
      `).join('');
      document.getElementById('elements').innerHTML = elementsHtml;
      
      // Lucky elements
      document.getElementById('lucky').innerHTML = `
        <div class="lucky-box good">
          <h4>‚úì Lucky Elements Áî®Á•û</h4>
          <div>${data.luckyElements.join(', ')}</div>
        </div>
        <div class="lucky-box bad">
          <h4>‚úó Challenging ÂøåÁ•û</h4>
          <div>${data.unluckyElements.join(', ')}</div>
        </div>
      `;
      
      // Life cycles
      if (data.lifeCycles && data.lifeCycles.length > 0) {
        document.getElementById('cycles-card').style.display = 'block';
        const cyclesHtml = data.lifeCycles.map(c => `
          <div class="cycle">
            <div class="cycle-age">Age ${c.startAge}-${c.endAge}</div>
            <div class="cycle-ganzhi">${c.ganZhi}</div>
          </div>
        `).join('');
        document.getElementById('cycles').innerHTML = cyclesHtml;
      } else {
        document.getElementById('cycles-card').style.display = 'none';
      }
    }
  </script>
</body>
</html>
